<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ - RED SETTINGS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            margin-bottom: 15px;
            color: #ffdd57;
        }

        button {
            background: linear-gradient(45deg, #28a745, #34d058);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        #output {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.6;
        }

        .success {
            color: #28a745;
        }

        .error {
            color: #ff3b30;
        }

        .warning {
            color: #ffdd57;
        }

        .info {
            color: #007AFF;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            color: #ffdd57;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©</h1>

        <div class="test-section">
            <h2>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            <button onclick="testBasicGeneration()">ØªÙˆÙ„ÙŠØ¯ Ø­Ø³Ø§Ø³ÙŠØ© Ø¨Ø³ÙŠØ·Ø©</button>
            <button onclick="testAllPlayStyles()">Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø·</button>
            <button onclick="testWithEmulator()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ Ù…Ø­Ø§ÙƒÙŠ</button>
            <button onclick="testValidation()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚</button>
        </div>

        <div class="test-section">
            <h2>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
            <button onclick="runFullTest()">Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</button>
            <button onclick="testPerformance()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
            <button onclick="compareEngines()">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª</button>
            <button onclick="generateReport()">ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„</button>
        </div>

        <div class="test-section">
            <h2>Ø£Ø¯ÙˆØ§Øª</h2>
            <button onclick="clearOutput()">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="exportResults()">ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="showDeviceInfo()">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
        </div>

        <div id="output"></div>
    </div>

    <script type="module">
        import { sensitivityEngine } from './src/utils/sensitivity-engine.js';
        import { sensitivityValidator } from './src/utils/sensitivity-validator.js';
        import { getEmulatorProfile, applyEmulatorProfile } from './src/utils/emulator-profiles.js';

        // Make available globally
        window.sensitivityEngine = sensitivityEngine;
        window.sensitivityValidator = sensitivityValidator;
        window.getEmulatorProfile = getEmulatorProfile;
        window.applyEmulatorProfile = applyEmulatorProfile;

        let testResults = [];

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'success' ? 'success' : 
                            type === 'error' ? 'error' : 
                            type === 'warning' ? 'warning' : 'info';
            
            output.innerHTML += `<span class="${className}">${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        window.testBasicGeneration = function() {
            log('\nğŸ® Ø§Ø®ØªØ¨Ø§Ø± ØªÙˆÙ„ÙŠØ¯ Ø­Ø³Ø§Ø³ÙŠØ© Ø¨Ø³ÙŠØ·Ø©...', 'info');
            
            try {
                const result = sensitivityEngine.generateSensitivity('medium', 'medium');
                
                log('âœ… ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                log('\nØ§Ù„Ø­Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©:', 'info');
                log(`  â€¢ Ø¹Ø§Ù…Ø©: ${result.sensitivities.general}`);
                log(`  â€¢ Ù†Ù‚Ø·Ø© Ø­Ù…Ø±Ø§Ø¡: ${result.sensitivities.redDot}`);
                log(`  â€¢ Ø³ÙƒÙˆØ¨ 2x: ${result.sensitivities.scope2x}`);
                log(`  â€¢ Ø³ÙƒÙˆØ¨ 4x: ${result.sensitivities.scope4x}`);
                log(`  â€¢ Ù‚Ù†Ø§ØµØ©: ${result.sensitivities.sniper}`);
                log(`  â€¢ Ù†Ø¸Ø± Ø­Ø±: ${result.sensitivities.freeLook}`);
                log(`  â€¢ Ø²Ø± Ø§Ù„Ø¶Ø±Ø¨: ${result.sensitivities.fireButtonSize}`);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚
                const validation = sensitivityValidator.validate(result.sensitivities);
                log(`\nğŸ“Š Ø§Ù„Ù†Ù‚Ø§Ø·: ${validation.score}/100`, validation.score >= 90 ? 'success' : 'warning');
                
                testResults.push({ test: 'basic', result, validation });
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        window.testAllPlayStyles = function() {
            log('\nğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù„Ø¹Ø¨...', 'info');
            
            const styles = ['fast', 'medium', 'slow', 'proSniper', 'aggressive', 'tactical'];
            let totalScore = 0;
            let allValid = true;

            styles.forEach(style => {
                try {
                    const result = sensitivityEngine.generateSensitivity(style, 'medium');
                    const validation = sensitivityValidator.validate(result.sensitivities);
                    
                    log(`\nğŸ“Š ${style}:`, 'info');
                    log(`   Ø§Ù„Ù†Ù‚Ø§Ø·: ${validation.score}/100`, validation.score >= 90 ? 'success' : 'warning');
                    log(`   ØµØ§Ù„Ø­: ${validation.isValid ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}`, validation.isValid ? 'success' : 'error');
                    
                    if (validation.errors.length > 0) {
                        log(`   Ø£Ø®Ø·Ø§Ø¡: ${validation.errors.length}`, 'error');
                        allValid = false;
                    }
                    
                    totalScore += validation.score;
                    testResults.push({ test: style, result, validation });
                } catch (error) {
                    log(`   âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                    allValid = false;
                }
            });

            const avgScore = totalScore / styles.length;
            log(`\nğŸ“ˆ Ù…Ù„Ø®Øµ:`, 'info');
            log(`   Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·: ${avgScore.toFixed(1)}/100`, avgScore >= 90 ? 'success' : 'warning');
            log(`   Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØµØ§Ù„Ø­Ø©: ${allValid ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}`, allValid ? 'success' : 'error');
        };

        window.testWithEmulator = function() {
            log('\nğŸ–¥ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹ Ù…Ø­Ø§ÙƒÙŠ...', 'info');
            
            try {
                const emulatorSettings = applyEmulatorProfile('BlueStacks', 'optimal');
                log('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ:', 'info');
                log(JSON.stringify(emulatorSettings, null, 2));
                
                const result = sensitivityEngine.generateSensitivity('fast', 'large', emulatorSettings);
                const validation = sensitivityValidator.validate(result.sensitivities);
                
                log('\nâœ… ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ!', 'success');
                log(`Ø§Ù„Ù†Ù‚Ø§Ø·: ${validation.score}/100`, validation.score >= 90 ? 'success' : 'warning');
                
                testResults.push({ test: 'emulator', result, validation });
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        window.testValidation = function() {
            log('\nğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚...', 'info');
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©
            const validSens = {
                general: 100,
                redDot: 90,
                scope2x: 75,
                scope4x: 60,
                sniper: 45,
                freeLook: 105,
                fireButtonSize: 50
            };
            
            const validation1 = sensitivityValidator.validate(validSens);
            log('Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©:', 'info');
            log(`  Ø§Ù„Ù†Ù‚Ø§Ø·: ${validation1.score}/100`, validation1.score >= 90 ? 'success' : 'warning');
            log(`  ØµØ§Ù„Ø­: ${validation1.isValid ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}`, validation1.isValid ? 'success' : 'error');
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠÙ… Ø®Ø§Ø·Ø¦Ø©
            const invalidSens = {
                general: 50,
                redDot: 100, // Ø®Ø·Ø£: Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¹Ø§Ù…Ø©
                scope2x: 75,
                scope4x: 60,
                sniper: 45,
                freeLook: 55,
                fireButtonSize: 50
            };
            
            const validation2 = sensitivityValidator.validate(invalidSens);
            log('\nØ§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠÙ… Ø®Ø§Ø·Ø¦Ø©:', 'info');
            log(`  Ø§Ù„Ù†Ù‚Ø§Ø·: ${validation2.score}/100`, 'warning');
            log(`  ØµØ§Ù„Ø­: ${validation2.isValid ? 'Ù†Ø¹Ù…' : 'Ù„Ø§ âŒ'}`, 'error');
            log(`  Ø£Ø®Ø·Ø§Ø¡: ${validation2.errors.length}`, 'error');
            validation2.errors.forEach(err => log(`    - ${err}`, 'error'));
        };

        window.runFullTest = function() {
            log('\nğŸ§ª Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„...', 'info');
            
            try {
                const testResult = sensitivityValidator.testEngine(sensitivityEngine);
                
                log('\nğŸ“ˆ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„:', 'success');
                log(`Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·: ${testResult.avgScore.toFixed(1)}/100`, testResult.avgScore >= 90 ? 'success' : 'warning');
                log(`Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØµØ§Ù„Ø­Ø©: ${testResult.allValid ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}`, testResult.allValid ? 'success' : 'error');
                
                testResults.push({ test: 'full', result: testResult });
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        window.testPerformance = function() {
            log('\nâš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡...', 'info');
            
            const iterations = 1000;
            const start = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                sensitivityEngine.generateSensitivity('medium', 'medium');
            }
            
            const end = performance.now();
            const duration = end - start;
            const avgTime = duration / iterations;
            
            log(`âœ… ØªÙ… Ø¥Ù†Ø¬Ø§Ø² ${iterations} Ø¹Ù…Ù„ÙŠØ© ØªÙˆÙ„ÙŠØ¯`, 'success');
            log(`Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${duration.toFixed(2)}ms`);
            log(`Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: ${avgTime.toFixed(3)}ms`);
            log(`Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠØ©: ${(1000 / avgTime).toFixed(0)}`);
            
            if (avgTime < 5) {
                log('ğŸš€ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²!', 'success');
            } else if (avgTime < 10) {
                log('âœ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯', 'success');
            } else {
                log('âš ï¸ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†', 'warning');
            }
        };

        window.generateReport = function() {
            log('\nğŸ“„ ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„...', 'info');
            
            try {
                const result = sensitivityEngine.generateSensitivity('medium', 'medium');
                const report = sensitivityValidator.generateReport(result.sensitivities);
                
                log('\nğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„:', 'info');
                log(`  Ø§Ù„Ù†Ø·Ø§Ù‚: ${report.analysis.range.min} - ${report.analysis.range.max}`);
                log(`  Ø§Ù„Ù…ØªÙˆØ³Ø·: ${report.analysis.average.toFixed(1)}`);
                log(`  Ø§Ù„Ø§Ù†Ø­Ø±Ø§Ù Ø§Ù„Ù…Ø¹ÙŠØ§Ø±ÙŠ: ${report.analysis.distribution.standardDeviation.toFixed(2)}`);
                log(`  Ø§Ù„Ø§ØªØ³Ø§Ù‚: ${report.analysis.consistency.isConsistent ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}`, report.analysis.consistency.isConsistent ? 'success' : 'warning');
                
                log('\nğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª:', 'info');
                report.recommendations.forEach(rec => log(`  ${rec}`));
                
                testResults.push({ test: 'report', report });
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        };

        window.showDeviceInfo = function() {
            log('\nğŸ“± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:', 'info');
            
            const profile = sensitivityEngine.deviceProfile;
            
            log(`  Ø§Ù„Ø¯Ù‚Ø©: ${profile.width}x${profile.height}`);
            log(`  Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©: ${profile.physicalWidth}x${profile.physicalHeight}`);
            log(`  Pixel Ratio: ${profile.pixelRatio}`);
            log(`  Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø±Ø¶: ${profile.aspectRatio.toFixed(2)}`);
            log(`  Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²: ${profile.deviceType}`);
            log(`  Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${profile.ram} GB`);
            log(`  Ø£Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬: ${profile.cpuCores}`);
            log(`  Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ø§Ø¡: ${(profile.performanceLevel * 100).toFixed(0)}%`);
            log(`  Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${profile.refreshRate} Hz`);
        };

        window.clearOutput = function() {
            document.getElementById('output').innerHTML = '';
            testResults = [];
        };

        window.exportResults = function() {
            if (testResults.length === 0) {
                log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                return;
            }
            
            const data = JSON.stringify(testResults, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-results-${Date.now()}.json`;
            a.click();
            
            log('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'success');
        };

        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        log('ğŸ® Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø­Ø±Ùƒ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©!', 'success');
        log('Ø§Ø®ØªØ± Ø§Ø®ØªØ¨Ø§Ø±Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ù„Ø¨Ø¯Ø¡.\n', 'info');
    </script>
</body>
</html>
