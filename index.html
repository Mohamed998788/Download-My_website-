<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED SETTINGS - Free Fire</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .auth-page .navbar,
        .auth-page .get-app-button,
        .auth-page .chat-button {
            display: none;
        }
    </style>
</head>
<body>
<!-- زر تحميل التطبيق في أعلى الصفحة -->
    <div class="get-app-button" onclick="showAppDownloadPopup()" title="تحميل التطبيق">
        <i class="fas fa-mobile-alt"></i>
    </div>

    <!-- زر إعدادات اللاعبين -->
    <div class="players-settings-button" onclick="showPage('players-settings'); loadPlayerSettings();" title="إعدادات اللاعبين">
        <i class="fas fa-users-cog"></i>
    </div>

    <!-- شريط التنقل الرئيسي -->

    <!-- إضافة حماية من استخراج الأكواد وحماية للموقع -->
    <script>
        // منع عرض صفحة المصدر
        document.addEventListener('contextmenu', event => event.preventDefault());

        // منع استخدام مفاتيح التطوير
        document.onkeydown = function(e) {
            // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C, Ctrl+U
            if (
                e.keyCode === 123 || 
                (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) ||
                (e.ctrlKey && e.keyCode === 85)
            ) {
                return false;
            }
        };

        // منع سحب الصور
        document.addEventListener('dragstart', function(event) {
            event.preventDefault();
            return false;
        });

        // منع تحديد النص
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
        });

        // كشف أدوات المطور
        function detectDevTools() {
            const devtoolsOpen = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor) 
                ? window.outerWidth - window.innerWidth > 200 || window.outerHeight - window.innerHeight > 200
                : window.outerWidth - window.innerWidth > 160 || window.outerHeight - window.innerHeight > 160;

            if (devtoolsOpen) {
                // إعادة تحميل الصفحة أو إجراء آخر
                location.href = 'about:blank';
            }
        }

        // التحقق الدوري
        setInterval(detectDevTools, 1000);

        // إخفاء الأكواد المصدرية
        (function(){
            const originalLog = console.log;
            const originalWarn = console.warn;
            const originalError = console.error;
            const originalInfo = console.info;

            // استبدال وظائف التسجيل بوظائف فارغة
            console.log = function() {};
            console.warn = function() {};
            console.error = function() {};
            console.info = function() {};

            // إخفاء معلومات الخطأ
            window.onerror = function() {
                return true; // منع عرض رسائل الخطأ
            };

            // بيانات حماية
            const securityToken = btoa(Math.random().toString(36).substring(2));
            document.documentElement.setAttribute('data-security', securityToken);

            // تشفير متقدم للمحتوى الحساس
            function obfuscateCode() {
                const scripts = document.querySelectorAll('script:not([data-security])');
                scripts.forEach(script => {
                    script.setAttribute('data-security', securityToken);
                });
            }

            // تطبيق التشفير بعد تحميل الصفحة
            window.addEventListener('DOMContentLoaded', obfuscateCode);
        })();

        // حماية إضافية: التعامل مع محاولات التتبع
        (function() {
            const excludedPaths = ['script.js', 'styles.css'];
            const currentScript = document.currentScript;

            if (currentScript && currentScript.src) {
                const scriptUrl = new URL(currentScript.src);
                const scriptPath = scriptUrl.pathname.split('/').pop();

                if (!excludedPaths.includes(scriptPath)) {
                    // منع الوصول إلى نصوص غير مصرح بها
                    currentScript.remove();
                }
            }
        })();

    </script>

    <div class="navbar">
        <a href="#home" onclick="showPage('home')" title="الرئيسية"><i class="fas fa-home"></i></a>
        <a href="#settings" onclick="showPage('settings')" title="الإعدادات"><i class="fas fa-cog"></i></a>
        <a href="#saved-sensitivities" onclick="showPage('saved-sensitivities')" title="الحساسيات المحفوظة"><i class="fas fa-save"></i></a>
        <a href="#more" onclick="toggleExtraNavbar()" title="المزيد"><i class="fas fa-ellipsis-h"></i></a>
    </div>

    <!-- شريط التنقل الإضافي -->
    <div class="extra-navbar" id="extraNavbar">
        <a href="#tips" onclick="showPage('tips')"><i class="fas fa-lightbulb"></i> نصائح لاحتراف فري فاير</a>
        <a href="#user-guide" onclick="showPage('user-guide')"><i class="fas fa-book"></i> دليل المستخدم</a>
        <a href="#about" onclick="showPage('about')"><i class="fas fa-info-circle"></i> حول الموقع</a>
        <a href="#players-settings" onclick="showPage('players-settings')" class="players-settings-link"><i class="fas fa-users-cog"></i> إعدادات اللاعبين</a>
        <a href="#pubg-settings" onclick="showPage('pubg-settings')"><i class="fas fa-gamepad"></i> إعدادات ببجي موبايل</a>
    </div>

    <!-- صفحة تحميل التطبيق -->
    <div class="app-download-popup" id="appDownloadPopup">
        <span class="close-btn" onclick="closeAppDownloadPopup()">&times;</span>
        <h2>تحميل التطبيق</h2>
        <div class="download-buttons">
            <a href="https://www.mediafire.com/file/tugf7saytz4hgvr/RED+SETTINGS-v1-release.apk/file" target="_blank">APK</a>
        </div>
    </div>

    <!-- صفحة الدردشة -->
    <div class="chat-container" id="chatContainer">
        <span class="close-btn" onclick="closeChat()">&times;</span>
        <h2>الدردشة</h2>
        <div class="chat-box" id="chatBox">
            <div class="message bot">مرحبًا! كيف يمكنني مساعدتك اليوم؟</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="اكتب رسالتك هنا...">
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- الصفحة الرئيسية -->
    <div class="container" id="home">
        <h1>توليد إعدادات Free Fire</h1>

        <div class="options-container">
            <!-- خيارات سرعة الحساسية -->
            <div class="option-section">
                <h2>سرعة الحساسية</h2>
                <div class="speed-options">
                    <input type="radio" name="speed" id="slow" value="slow">
                    <label for="slow" title="بطيئة - مناسبة للتصويب الدقيق">
                        <i class="fas fa-user-ninja"></i>
                        <span>بطيئة</span>
                        <small>مناسبة للقنص والتصويب الدقيق</small>
                    </label>
                    
                    <input type="radio" name="speed" id="medium" value="medium">
                    <label for="medium" title="متوسطة - توازن بين السرعة والدقة">
                        <i class="fas fa-walking"></i>
                        <span>متوسطة</span>
                        <small>توازن بين السرعة والدقة</small>
                    </label>
                    
                    <input type="radio" name="speed" id="fast" value="fast" checked>
                    <label for="fast" title="سريعة - مثالية للاعبين المحترفين">
                        <i class="fas fa-running"></i>
                        <span>سريعة</span>
                        <small>مثالية للاعبين المحترفين</small>
                    </label>
                </div>
            </div>

            <!-- خيارات حجم زر الضرب -->
            <div class="option-section">
                <h2>حجم زر الضرب</h2>
                <div class="fire-button-size-options">
                    <input type="radio" name="fire-button-size" id="small" value="small">
                    <label for="small" title="صغير - للتحكم الدقيق">
                        <i class="fas fa-compress-alt"></i>
                        <span>صغير</span>
                        <small>للتحكم الدقيق وتوفير مساحة</small>
                    </label>
                    
                    <input type="radio" name="fire-button-size" id="medium-size" value="medium" checked>
                    <label for="medium-size" title="متوسط - مناسب لمعظم اللاعبين">
                        <i class="fas fa-expand"></i>
                        <span>متوسط</span>
                        <small>مناسب لمعظم اللاعبين</small>
                    </label>
                    
                    <input type="radio" name="fire-button-size" id="large" value="large">
                    <label for="large" title="كبير - سهولة الضغط السريع">
                        <i class="fas fa-expand-arrows-alt"></i>
                        <span>كبير</span>
                        <small>سهولة الضغط السريع</small>
                    </label>
                </div>
            </div>
        </div>

        <!-- توليد الحساسيات -->
        <div class="generate-buttons-container">
            <button id="generate-sensitivity-button" onclick="calculateSensitivity()" class="pulse-effect">
                <i class="fas fa-magic"></i> توليد الحساسيات التلقائية
            </button>
            <button id="generate-random-sensitivity" onclick="generateRandomSensitivity()" style="margin-top: 15px;">
                <i class="fas fa-random"></i> توليد حساسية أخرى
            </button>
        </div>

        <div class="result" id="result">
            <div class="result-placeholder">اضغط على زر التوليد للحصول على أفضل الإعدادات لجهازك</div>
        </div>

        <!-- توليد إعدادات الجرافيك -->
        <div class="graphics-settings">
            <button onclick="generateGraphicsSettings()" class="graphics-button">
                <i class="fas fa-desktop"></i> توليد إعدادات الجرافيك
            </button>
            <div class="graphics-result" id="graphics-result"></div>
        </div>

        <!-- تم إزالة زر إعدادات اللاعبين -->
    </div>

    <!-- صفحة الإعدادات -->
    <div class="container" id="settings" style="display: none;">
        <h1>الإعدادات</h1>
        <div class="settings-content">
            <h2>تغيير حجم الخط</h2>
            <input type="range" min="12" max="24" value="16" id="font-size">
            <span id="font-size-value">16px</span>

            <h2>تغيير اللغة</h2>
            <select id="language-select">
                <option value="ar">العربية</option>
                <option value="en">English</option>
                <option value="es">Español</option>
                <option value="it">Italiano</option>
                <option value="pt">Português</option>
            </select>

            <h2>تغيير الثيم</h2>
            <button onclick="toggleDarkMode()"><i class="fas fa-moon"></i> تفعيل الوضع الليلي</button>
            <h3>اختيار لون الثيم</h3>
            <input type="color" id="theme-color" value="#1e3c72">
            <button class="reset-theme-button" onclick="resetThemeColor()"><i class="fas fa-undo"></i> إعادة تعيين اللون</button>
        </div>
    </div>

    <!-- صفحة الحساسيات المحفوظة -->
    <div class="container saved-sensitivities-page" id="saved-sensitivities" style="display: none;">
        <h1>الإعدادات المحفوظة</h1>
        <ul id="saved-sensitivities-list"></ul>
    </div>

    <!-- صفحة التواصل معنا -->
    <div class="container contact-page" id="contact" style="display: none;">
        <h1>تواصل معنا</h1>
        <div class="contact-content">
            <h2>الدعم الفني</h2>
            <p>للاستفسارات أو الدعم الفني، يرجى التواصل عبر:</p>
            <ul>
                <li><strong>البريد الإلكتروني:</strong> <a href="mailto:support@example.com">support@example.com</a></li>
                <li><strong>الهاتف:</strong> +123456789</li>
            </ul>
            <h2>وسائل التواصل الاجتماعي</h2>
            <p>تابعنا على وسائل التواصل الاجتماعي:</p>
            <div class="social-icons">
                <a href="https://www.facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
                <a href="https://www.youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://www.whatsapp.com" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>

            <!-- الأسئلة الشائعة -->
            <div class="faq-section">
                <h2>الأسئلة الشائعة</h2>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <h3>كيف يمكنني تغيير الحساسية؟</h3>
                    <p>يمكنك تغيير الحساسية من خلال الذهاب إلى صفحة الإعدادات وتحديد الحساسية المطلوبة.</p>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <h3>هل يمكنني حفظ الإعدادات؟</h3>
                    <p>نعم، يمكنك حفظ الإعدادات من خلال الضغط على زر "حفظ" في صفحة النتائج.</p>
                </div>
                <div class="faq-item" onclick="toggleFAQ(this)">
                    <h3>كيف يمكنني التواصل مع الدعم الفني؟</h3>
                    <p>يمكنك التواصل مع الدعم الفني عبر البريد الإلكتروني أو الهاتف الموجود في صفحة "تواصل معنا".</p>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة نصائح لاحتراف فري فاير -->
    <div class="container" id="tips" style="display: none;">
        <h1>نصائح لاحتراف فري فاير</h1>
        <div class="tips-content">
            <h2>نصائح عامة</h2>
            <ul>
                <li>استخدم الغطاء بشكل فعال لتجنب النيران المعادية.</li>
                <li>حاول دائمًا البقاء في حركة مستمرة لتجنب أن تكون هدفًا سهلًا.</li>
                <li>استخدم السماعات لتحديد موقع الأعداء من خلال الأصوات.</li>
                <li>تعلم كيفية استخدام الأدوات بشكل فعال مثل القنابل والدخان.</li>
                <li>حاول دائمًا البقاء في مناطق آمنة وتجنب المناطق المفتوحة.</li>
                <li>استخدم المركبات للتنقل بسرعة وتجنب الأعداء.</li>
                <li>تعلم كيفية استخدام الأسلحة المختلفة بشكل فعال.</li>
                <li>حاول دائمًا البقاء في فريق والتواصل مع زملائك.</li>
                <li>تعلم كيفية استخدام الأدوات الطبية بشكل فعال.</li>
                <li>حاول دائمًا البقاء في مناطق آمنة وتجنب المناطق المفتوحة.</li>
            </ul>
            <h2>نصائح للتصويب</h2>
            <ul>
                <li>حاول دائمًا التصويب نحو الرأس للحصول على أكبر قدر من الضرر.</li>
                <li>استخدم الأسلحة المناسبة للمسافات المختلفة.</li>
                <li>تدرب على التصويب في الوضع التدريبي لتحسين مهاراتك.</li>
                <li>تعلم كيفية استخدام الأدوات بشكل فعال مثل القنابل والدخان.</li>
                <li>حاول دائمًا البقاء في مناطق آمنة وتجنب المناطق المفتوحة.</li>
                <li>استخدم المركبات للتنقل بسرعة وتجنب الأعداء.</li>
                <li>تعلم كيفية استخدام الأسلحة المختلفة بشكل فعال.</li>
                <li>حاول دائمًا البقاء في فريق والتواصل مع زملائك.</li>
                <li>تعلم كيفية استخدام الأدوات الطبية بشكل فعال.</li>
                <li>حاول دائمًا البقاء في مناطق آمنة وتجنب المناطق المفتوحة.</li>
            </ul>
        </div>
    </div>

    <!-- صفحة دليل المستخدم -->
    <div class="container" id="user-guide" style="display: none;">
        <h1>دليل المستخدم</h1>
        <div class="user-guide-content">
            <h2>كيفية استخدام التطبيق</h2>
            <p>1. اختر سرعة الحساسية المفضلة لديك من الخيارات المتاحة.</p>
            <p>2. اختر حجم زر الضرب المناسب لك.</p>
            <p>3. اضغط على زر "توليد الحساسيات التلقائية" للحصول على الإعدادات المثالية.</p>
            <p>4. يمكنك حفظ الإعدادات أو مشاركتها مع الأصدقاء.</p>
            <p>5. استخدم صفحة الإعدادات لتغيير حجم الخط واللغة والثيم.</p>
            <p>6. استخدم صفحة الحساسيات المحفوظة لعرض الإعدادات التي قمت بحفظها.</p>
            <p>7. استخدم صفحة التواصل معنا للتواصل مع الدعم الفني.</p>
            <p>8. استخدم صفحة نصائح لاحتراف فري فاير لتحسين مهاراتك في اللعبة.</p>
            <p>9. استخدم صفحة دليل المستخدم لفهم كيفية استخدام التطبيق بشكل أفضل.</p>
            <p>10. استخدم صفحة حول الموقع لمعرفة المزيد عن التطبيق.</p>
            <p>11. استخدم صفحة الأسئلة الشائعة للعثور على إجابات للأسئلة الشائعة.</p>
            <p>12. استخدم صفحة الإعدادات لتغيير حجم الخط واللغة والثيم.</p>
            <p>13. استخدم صفحة الحساسيات المحفوظة لعرض الإعدادات التي قمت بحفظها.</p>
            <p>14. استخدم صفحة التواصل معنا للتواصل مع الدعم الفني.</p>
            <p>15. استخدم صفحة نصائح لاحتراف فري فاير لتحسين مهاراتك في اللعبة.</p>
            <p>16. استخدم صفحة دليل المستخدم لفهم كيفية استخدام التطبيق بشكل أفضل.</p>
            <p>17. استخدم صفحة حول الموقع لمعرفة المزيد عن التطبيق.</p>
            <p>18. استخدم صفحة الأسئلة الشائعة للعثور على إجابات للأسئلة الشائعة.</p>
            <p>19. استخدم صفحة الإعدادات لتغيير حجم الخط واللغة والثيم.</p>
            <p>20. استخدم صفحة الحساسيات المحفوظة لعرض الإعدادات التي قمت بحفظها.</p>
        </div>
    </div>

    <!-- صفحة حول الموقع -->
    <div class="container" id="about" style="display: none;">
        <h1>حول الموقع</h1>
        <div class="about-content">
            <h2>معلومات عن الموقع</h2>
            <ul>
                <li><strong>رقم الإصدار:</strong> 1.0.0</li>
                <li><strong>منشئ الموقع:</strong> Mohamed Youssef</li>
                <li><strong>لغة برمجة الموقع:</strong> HTML, CSS, JavaScript</li>
            </ul>
        </div>
    </div>

    <!-- صفحة إعدادات اللاعبين -->
    <div class="container" id="players-settings" style="display: none;">
        <h1>إعدادات اللاعبين</h1>

        <!-- نموذج إضافة الإعدادات -->
        <div class="player-settings-form">
            <h2>إضافة إعدادات جديدة</h2>
            <form id="settings-form">
                <div class="form-group">
                    <label for="player-name">اسم اللاعب</label>
                    <input type="text" id="player-name" required>
                </div>
                <div class="form-group">
                    <label for="device-name">اسم الجهاز</label>
                    <input type="text" id="device-name" required>
                </div>
                <div class="form-group">
                    <label for="general-sensitivity">حساسية عامة</label>
                    <input type="number" id="general-sensitivity" min="1" max="200" required>
                </div>
                <div class="form-group">
                    <label for="red-dot-sensitivity">حساسية النقطة الحمراء</label>
                    <input type="number" id="red-dot-sensitivity" min="1" max="200" required>
                </div>
                <div class="form-group">
                    <label for="scope2x-sensitivity">حساسية منظار 2x</label>
                    <input type="number" id="scope2x-sensitivity" min="1" max="200" required>
                </div>
                <div class="form-group">
                    <label for="scope4x-sensitivity">حساسية منظار 4x</label>
                    <input type="number" id="scope4x-sensitivity" min="1" max="200" required>
                </div>
                <div class="form-group">
                    <label for="sniper-sensitivity">حساسية القناصة</label>
                    <input type="number" id="sniper-sensitivity" min="1" max="200" required>
                </div>
                <div class="form-group">
                    <label for="free-look-sensitivity">حساسية النظرة الحرة</label>
                    <input type="number" id="free-look-sensitivity" min="1" max="200" required>
                </div>
                <button type="submit" id="publish-settings-btn">
                    <i class="fas fa-upload"></i> نشر الإعدادات
                </button>
            </form>
        </div>

        <!-- عرض إعدادات اللاعبين -->
        <div class="players-settings-container">
            <h2>إعدادات اللاعبين المنشورة</h2>
            <div id="players-settings-list" class="settings-list">
                <!-- سيتم ملء هذا القسم ديناميكيًا بواسطة JavaScript -->
                <div class="loading-spinner" id="settings-loading">
                    <i class="fas fa-spinner fa-spin"></i> جاري تحميل البيانات...
                </div>
            </div>
        </div>
    </div>

    <!-- إضافة صفحة إعدادات ببجي موبايل -->
    <div class="container" id="pubg-settings" style="display: none;">
        <h1>توليد إعدادات PUBG Mobile</h1>

        <div class="options-container">
            <!-- خيارات سرعة الحساسية لببجي -->
            <div class="option-section">
                <h2>سرعة الحساسية</h2>
                <div class="speed-options">
                    <input type="radio" name="pubg-speed" id="pubg-slow" value="slow">
                    <label for="pubg-slow" title="بطيئة - مناسبة للقنص">
                        <i class="fas fa-user-ninja"></i>
                        <span>بطيئة</span>
                        <small>مناسبة للقنص والتصويب الدقيق</small>
                    </label>
                    
                    <input type="radio" name="pubg-speed" id="pubg-medium" value="medium">
                    <label for="pubg-medium" title="متوسطة - توازن بين السرعة والدقة">
                        <i class="fas fa-walking"></i>
                        <span>متوسطة</span>
                        <small>توازن بين السرعة والدقة</small>
                    </label>
                    
                    <input type="radio" name="pubg-speed" id="pubg-fast" value="fast" checked>
                    <label for="pubg-fast" title="سريعة - مثالية للاعبين المحترفين">
                        <i class="fas fa-running"></i>
                        <span>سريعة</span>
                        <small>مثالية للاعبين المحترفين</small>
                    </label>
                </div>
            </div>

            <!-- خيارات الجيروسكوب -->
            <div class="option-section">
                <h2>إعدادات الجيروسكوب</h2>
                <div class="gyro-options">
                    <input type="radio" name="gyro" id="gyro-off" value="off">
                    <label for="gyro-off" title="بدون جيروسكوب">
                        <i class="fas fa-times-circle"></i>
                        <span>إيقاف</span>
                        <small>اللعب بدون جيروسكوب</small>
                    </label>
                    
                    <input type="radio" name="gyro" id="gyro-scope" value="scope" checked>
                    <label for="gyro-scope" title="جيروسكوب عند التصويب">
                        <i class="fas fa-crosshairs"></i>
                        <span>تصويب فقط</span>
                        <small>تفعيل عند استخدام المناظير</small>
                    </label>
                    
                    <input type="radio" name="gyro" id="gyro-full" value="full">
                    <label for="gyro-full" title="جيروسكوب دائم">
                        <i class="fas fa-sync"></i>
                        <span>دائم</span>
                        <small>تفعيل في جميع الأوقات</small>
                    </label>
                </div>
            </div>
        </div>

        <!-- توليد الحساسيات -->
        <div class="generate-buttons-container">
            <button id="generate-pubg-sensitivity" onclick="calculatePubgSensitivity()" class="pulse-effect">
                <i class="fas fa-magic"></i> توليد حساسيات ببجي
            </button>
            <button id="generate-random-pubg" onclick="generateRandomPubgSensitivity()" style="margin-top: 15px;">
                <i class="fas fa-random"></i> توليد حساسية أخرى
            </button>
        </div>

        <div class="result" id="pubg-result">
            <div class="result-placeholder">اضغط على زر التوليد للحصول على أفضل إعدادات ببجي</div>
        </div>

        <!-- إعدادات الجرافيك -->
        <div class="graphics-settings">
            <button onclick="generatePubgGraphicsSettings()" class="graphics-button">
                <i class="fas fa-desktop"></i> توليد إعدادات الجرافيك
            </button>
            <div class="graphics-result" id="pubg-graphics-result"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD2Jujt76Nmuvxas-TRQeIQHBJno_cnn4I",
            authDomain: "red-s-a22d1.firebaseapp.com",
            projectId: "red-s-a22d1",
            storageBucket: "red-s-a22d1.firebasestorage.app",
            messagingSenderId: "121931518670",
            appId: "1:121931518670:web:b8318c7ee1ff8d5fad769f",
            measurementId: "G-7CGP1VP0MT"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // إضافة الإعدادات إلى Firestore
        window.publishPlayerSettings = async function() {
            try {
                const playerName = document.getElementById('player-name').value;
                const deviceName = document.getElementById('device-name').value;
                const generalSensitivity = document.getElementById('general-sensitivity').value;
                const redDotSensitivity = document.getElementById('red-dot-sensitivity').value;
                const scope2xSensitivity = document.getElementById('scope2x-sensitivity').value;
                const scope4xSensitivity = document.getElementById('scope4x-sensitivity').value;
                const sniperSensitivity = document.getElementById('sniper-sensitivity').value;
                const freeLookSensitivity = document.getElementById('free-look-sensitivity').value;

                const settingsData = {
                    playerName,
                    deviceName,
                    generalSensitivity: Number(generalSensitivity),
                    redDotSensitivity: Number(redDotSensitivity),
                    scope2xSensitivity: Number(scope2xSensitivity),
                    scope4xSensitivity: Number(scope4xSensitivity),
                    sniperSensitivity: Number(sniperSensitivity),
                    freeLookSensitivity: Number(freeLookSensitivity),
                    publishedAt: new Date()
                };

                const docRef = await addDoc(collection(db, "playersSettings"), settingsData);
                console.log("إعدادات تم نشرها بنجاح! معرف المستند: ", docRef.id);

                // إظهار رسالة نجاح
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.innerHTML = '<i class="fas fa-check-circle"></i> تم نشر إعداداتك بنجاح!';
                document.getElementById('settings-form').appendChild(successMessage);

                // إعادة تحميل القائمة
                loadPlayerSettings();

                // مسح النموذج
                document.getElementById('settings-form').reset();

                // إزالة رسالة النجاح بعد 3 ثوان
                setTimeout(() => {
                    successMessage.remove();
                }, 3000);
            } catch (error) {
                console.error("خطأ في نشر الإعدادات: ", error);
                alert("حدث خطأ أثناء نشر الإعدادات. يرجى المحاولة مرة أخرى.");
            }
        };

        // تحميل الإعدادات من Firestore
        window.loadPlayerSettings = async function() {
            try {
                console.log("بدء تحميل إعدادات اللاعبين...");
                const settingsList = document.getElementById('players-settings-list');
                if (!settingsList) {
                    console.error("لم يتم العثور على عنصر players-settings-list");
                    return;
                }

                settingsList.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> جاري تحميل البيانات...</div>';

                // تأكد من إنشاء المرجع بشكل صحيح
                try {
                    const playersSettingsRef = collection(db, "playersSettings");
                    const q = query(playersSettingsRef, orderBy("publishedAt", "desc"), limit(50));
                    console.log("تم إنشاء الاستعلام بنجاح");

                    const querySnapshot = await getDocs(q);
                    console.log(`تم استرجاع ${querySnapshot.size} من نتائج الاستعلام`);

                    settingsList.innerHTML = '';

                    if (querySnapshot.empty) {
                        settingsList.innerHTML = '<div class="no-settings">لم يتم نشر أي إعدادات بعد</div>';
                        return;
                    }

                    querySnapshot.forEach((doc) => {
                        console.log(`معالجة المستند: ${doc.id}`);
                        const data = doc.data();
                        const settingsCard = document.createElement('div');
                        settingsCard.className = 'player-settings-card';

                        // التعامل مع التاريخ بشكل آمن
                        let dateStr = 'غير معروف';
                        try {
                            if (data.publishedAt && typeof data.publishedAt.toDate === 'function') {
                                dateStr = new Date(data.publishedAt.toDate()).toLocaleString('ar-SA');
                            } else if (data.publishedAt instanceof Date) {
                                dateStr = data.publishedAt.toLocaleString('ar-SA');
                            } else if (data.publishedAt) {
                                dateStr = 'تاريخ غير صالح';
                                console.warn("تنسيق تاريخ غير معروف:", data.publishedAt);
                            }
                        } catch (dateError) {
                            console.error("خطأ في معالجة التاريخ:", dateError);
                        }

                        settingsCard.innerHTML = `
                            <div class="player-settings-header">
                                <h3><i class="fas fa-user"></i> ${data.playerName || 'بدون اسم'}</h3>
                                <span class="device-name"><i class="fas fa-mobile-alt"></i> ${data.deviceName || 'جهاز غير معروف'}</span>
                                <span class="publish-date"><i class="fas fa-calendar-alt"></i> ${dateStr}</span>
                            </div>
                            <div class="player-settings-body">
                                <div class="sensitivity-item">
                                    <span>حساسية عامة</span>
                                    <span class="sensitivity-value">${data.generalSensitivity || 0}</span>
                                </div>
                                <div class="sensitivity-item">
                                    <span>حساسية النقطة الحمراء</span>
                                    <span class="sensitivity-value">${data.redDotSensitivity || 0}</span>
                                </div>
                                <div class="sensitivity-item">
                                    <span>حساسية منظار 2x</span>
                                    <span class="sensitivity-value">${data.scope2xSensitivity || 0}</span>
                                </div>
                                <div class="sensitivity-item">
                                    <span>حساسية منظار 4x</span>
                                    <span class="sensitivity-value">${data.scope4xSensitivity || 0}</span>
                                </div>
                                <div class="sensitivity-item">
                                    <span>حساسية القناصة</span>
                                    <span class="sensitivity-value">${data.sniperSensitivity || 0}</span>
                                </div>
                                <div class="sensitivity-item">
                                    <span>حساسية النظرة الحرة</span>
                                    <span class="sensitivity-value">${data.freeLookSensitivity || 0}</span>
                                </div>
                            </div>
                            <button class="copy-settings-btn" onclick="copySettings(${JSON.stringify(data).replace(/"/g, '&quot;')})">
                                <i class="fas fa-copy"></i> نسخ الإعدادات
                            </button>
                        `;

                        settingsList.appendChild(settingsCard);
                    });
                } catch (queryError) {
                    console.error("خطأ في تنفيذ الاستعلام:", queryError);
                    settingsList.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> حدث خطأ أثناء استرجاع البيانات</div>';
                }
            } catch (error) {
                console.error("خطأ في تحميل الإعدادات: ", error);
                const settingsList = document.getElementById('players-settings-list');
                if (settingsList) {
                    settingsList.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i> حدث خطأ أثناء تحميل البيانات</div>';
                }
            }
        };

        // نسخ الإعدادات
        window.copySettings = function(data) {
            // تعيين الإعدادات في النموذج الرئيسي
            const result = document.getElementById('result');
            if (result) {
                result.innerHTML = `
                    <div>حساسية عامة: ${data.generalSensitivity}</div>
                    <div>حساسية النقطة الحمراء: ${data.redDotSensitivity}</div>
                    <div>حساسية سكوب 2x: ${data.scope2xSensitivity}</div>
                    <div>حساسية سكوب 4x: ${data.scope4xSensitivity}</div>
                    <div>حساسية القناصة: ${data.sniperSensitivity}</div>
                    <div>حساسية النظر الحر: ${data.freeLookSensitivity}</div>
                    <div class="action-buttons">
                        <button onclick="shareSensitivity()"><i class="fas fa-share"></i> مشاركة</button>
                        <button onclick="saveSettings()"><i class="fas fa-save"></i> حفظ</button>
                    </div>
                `;

                // تحديث المتغير العام
                window.sensitivities = {
                    general: data.generalSensitivity,
                    redDot: data.redDotSensitivity,
                    scope2x: data.scope2xSensitivity,
                    scope4x: data.scope4xSensitivity,
                    sniper: data.sniperSensitivity,
                    freeLook: data.freeLookSensitivity
                };

                // الانتقال إلى الصفحة الرئيسية
                showPage('home');

                // عرض رسالة نجاح
                alert(`تم نسخ إعدادات اللاعب ${data.playerName} بنجاح!`);
            } else {
                alert("حدث خطأ أثناء نسخ الإعدادات!");
            }
        };

        // تهيئة معالجات الأحداث
        document.addEventListener('DOMContentLoaded', () => {
            // معالج حدث إرسال النموذج
            document.getElementById('settings-form').addEventListener('submit', function(e) {
                e.preventDefault();
                publishPlayerSettings();
            });

            // تحميل إعدادات اللاعبين عند فتح الصفحة
            window.addEventListener('hashchange', function() {
                if (window.location.hash === '#players-settings') {
                    console.log("تم تغيير الهاش إلى #players-settings");
                    setTimeout(loadPlayerSettings, 200);
                }
            });

            // تحميل الإعدادات عند النقر على رابط إعدادات اللاعبين
            const playerSettingsLinks = document.querySelectorAll('a[href="#players-settings"], .players-settings-button');
            playerSettingsLinks.forEach(link => {
                link.addEventListener('click', function() {
                    console.log("تم النقر على رابط إعدادات اللاعبين");
                    showPage('players-settings');
                    setTimeout(loadPlayerSettings, 300);
                });
            });

            // تحميل البيانات عند فتح الصفحة مباشرة إذا كانت صفحة إعدادات اللاعبين هي الصفحة الحالية
            if (window.location.hash === '#players-settings') {
                console.log("تم تحميل الصفحة على #players-settings");
                setTimeout(loadPlayerSettings, 500);
            }
        });
    </script>

    <script src="script.js"></script>
</body>
</html>
